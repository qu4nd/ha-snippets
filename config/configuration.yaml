# Loads default set of integrations. Do not remove.
default_config:

# config for cloudflare access
http:
  cors_allowed_origins:
    - https://google.com
    - https://www.home-assistant.io
  ip_ban_enabled: true
  login_attempts_threshold: 10
  use_x_forwarded_for: true
  trusted_proxies:
    - 172.16.0.0/12
    - 172.30.33.0/24

# Load frontend themes from the themes folder
frontend:
  themes: !include_dir_merge_named themes
  extra_module_url:
    - /local/community/custom-brand-icons/custom-brand-icons.js

# includes
automation: !include automations.yaml
script: !include scripts.yaml
scene: !include scenes.yaml
sensor: !include sensors.yaml

# recorder configuration
recorder:
  purge_keep_days: 60
  exclude:
    entities:
      - weather.forecast_home
      - sensor.i_got_5_on_it
      - sensor.loading
      - vacuum.helene_wischer
      - device_tracker.worx_landroid_m
      - sensor.pixel_8_pro_geocoded_location
      - sensor.pixel_4a_geocoded_location
      - update.rollo_buro_firmware_update
      - sensor.regenradar
      - sensor.wetterstation_aktuell_rohdaten
    entity_globs:
      - sensor.helene_wischer_*
      - button.helene_wischer_*
      - binary_sensor.helene_wischer_*
      - media_player.*
      - remote.*
      - switch.echo_dot_*
      - select.helene_wischer_*
      - image.helene_wischer_*
      - sensor.m_*
      - binary_sensor.m_*
      - binary_sensor.rollo_buro_*
      - sensor.echo_*_next_timer
      - switch.echo_*_do_not_disturb_switch
      - binary_sensor.e1_outdoor_*
      - sensor.rrr*
      - sensor.wetter_*

# Telegram Bot config
telegram_bot:
  - platform: polling
    api_key: !secret telegram_api_key
    allowed_chat_ids:
      - !secret telegram_chat_id_daniel
      - !secret telegram_chat_id_ina
notify:
  - platform: telegram
    name: ha_telegram_bot_daniel
    chat_id: !secret telegram_chat_id_daniel
  - platform: telegram
    name: ha_telegram_bot_ina
    chat_id: !secret telegram_chat_id_ina
  - name: all_telegram
    platform: group
    services:
      - service: ha_telegram_bot_daniel
      - service: ha_telegram_bot_ina

# Hue Emulation for Alexa Access
emulated_hue:
  type: alexa
  host_ip: 192.168.178.24
  listen_port: 80
  expose_by_default: false
  entities:
    light.licht_terrasse:
      name: "Terrasse"
      hidden: false
    switch.inspelning_treppe:
      name: "Korblampe"
      hidden: false

# Wetterstation
rest:
  - resource: https://api.weather.com/v2/pws/observations/current?apiKey=e1f10a1e78da46f5b10a1e78da96f525&stationId=IHERZO115&numericPrecision=decimal&format=json&units=m
    scan_interval: 600  # alle 10 Minuten
    sensor:
      - name: Wetterstation Aktuell Rohdaten
        value_template: >
          {{ value_json.observations[0].metric.temp }}
        json_attributes:
          - observations

template:
  - sensor:
      - name: Wetter Temperatur
        unit_of_measurement: "Â°C"
        device_class: temperature
        state_class: measurement
        state: >
          {{ state_attr('sensor.wetterstation_aktuell_rohdaten', 'observations')[0].metric.temp }}
      - name: Wetter Niederschlagsrate
        unit_of_measurement: "mm/h"
        device_class: precipitation
        state_class: measurement # oder total_increasing, je nach API-Verhalten
        state: >
          {{ state_attr('sensor.wetterstation_aktuell_rohdaten', 'observations')[0].metric.precipRate }}
      - name: Wetter Niederschlag gesamt
        unit_of_measurement: "mm"
        device_class: precipitation
        state_class: measurement # oder total_increasing, je nach API-Verhalten
        state: >
          {{ state_attr('sensor.wetterstation_aktuell_rohdaten', 'observations')[0].metric.precipTotal }}
      - name: Wetter Luftfeuchtigkeit
        unit_of_measurement: "%"
        device_class: humidity
        state_class: measurement
        state: >
          {{ state_attr('sensor.wetterstation_aktuell_rohdaten', 'observations')[0].humidity | round(0)}}